import pexpect
import time
import random

lamp = ["BE:FF:E5:01:A7:95", "BE:FF:E6:00:FD:5E"]
hci = ["hci0", "hci1"]

def GenColor():
    randColor = hex(random.randint(0, 255))
    return randColor

def GenColorCMD():
    randColor = ""
    for _ in range(0, 3):
        color = GenColor()
        if len(str(color)) < 4:
            randColor += str(color)[2:] + "0"
        else:
            randColor += str(color)[2:]
    mode = "df"
    luminosity = "ff"
    cmdCOLOR = "char-write-req 0x0008 7e07" + mode + luminosity + randColor + "00ef"
    # char-write-req 0x0008 7e070503ff000000ef
    return cmdCOLOR

print("Trying to connect...")
processA = pexpect.spawn("sudo gatttool -I -i " + hci[0])
processB = pexpect.spawn("sudo gatttool -I -i " + hci[1])

processA.sendline("connect " + lamp[0])
processB.sendline("connect " + lamp[1])

processA.expect("Connection successful", timeout=5)
print("Connection successful " + hci[0])
processB.expect("Connection successful", timeout=5)
print("Connection successful " + hci[1])

while 1:
    try:
        CMDA = GenColorCMD()
        CMDB = GenColorCMD()
        print("Sending : " + CMDA)
        print("Sending : " + CMDB)
        processA.sendline(CMDA)
        processB.sendline(CMDB)
        time.sleep(1)
    except:
        continue
